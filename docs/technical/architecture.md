# 架构设计

OneClip 采用简洁的 MVVM 架构设计，基于 SwiftUI 构建，确保高性能和良好的用户体验。

## 整体架构

### 核心层次

```
┌─────────────────────────────┐
│      SwiftUI Views          │
├─────────────────────────────┤
│    Manager Classes          │
│ (ClipboardManager, etc.)    │
├─────────────────────────────┤
│  Data Layer (Core Data)     │
├─────────────────────────────┤
│   macOS System APIs        │
└─────────────────────────────┘
```

### 设计原则

- **MVVM 模式**: View + ObservableObject 管理器
- **单一职责**: 每个管理器负责特定功能
- **数据驱动**: 使用 Core Data 进行数据持久化

## 核心组件

### ClipboardManager

负责剪贴板监控和历史记录管理。

**主要功能：**

- 监控系统剪贴板变化
- 保存和管理历史记录
- 提供搜索和筛选功能
- 处理不同类型的内容（文本、图片、文件等）

**实现方式：**

- 使用 NSPasteboard 监控剪贴板
- 定时器轮询机制
- 多线程处理避免阻塞 UI

### HotkeyManager

处理全局快捷键功能。

**主要功能：**

- 注册和管理全局快捷键
- 处理快捷键事件回调
- 支持自定义快捷键组合

**实现方式：**

- 基于 Carbon 框架 API
- 事件驱动机制

### SettingsManager

管理应用设置和配置。

**主要功能：**

- 保存和读取用户设置
- 设置持久化存储
- 设置变更通知

**实现方式：**

- 使用 UserDefaults 存储设置
- ObservableObject 实现响应式更新

### WindowManager

控制窗口显示和状态。

**主要功能：**

- 管理主窗口显示/隐藏
- 控制窗口位置和大小
- 处理多窗口协调

**实现方式：**

- 基于 NSWindow API
- SwiftUI 窗口管理

## 数据架构

### Core Data 模型

OneClip 使用 Core Data 进行数据持久化，主要实体包括：

**ClipboardItem（剪贴板项目）**

- id: 唯一标识符
- content: 内容数据
- type: 内容类型（文本、图片、文件等）
- createdAt: 创建时间
- isFavorite: 是否收藏

**QuickReply（快捷回复）**

- id: 唯一标识符
- title: 标题
- content: 内容
- category: 分类

### 数据存储

- **Core Data**: 主要数据存储
- **UserDefaults**: 应用设置
- **文件系统**: 大型文件和图片缓存

## 搜索功能

### 搜索实现

OneClip 提供简单高效的搜索功能：

**搜索方式：**

- 关键词匹配
- 内容类型筛选
- 时间范围筛选

**实现特点：**

- 实时搜索
- 支持中英文
- 模糊匹配

## 安全和隐私

### 数据安全

- **本地存储**: 所有数据仅存储在本地设备
- **权限控制**: 需要用户授权辅助功能权限
- **数据清理**: 支持手动和自动清理历史记录

### 隐私保护

- **敏感内容过滤**: 可设置过滤规则避免记录敏感信息
- **应用排除**: 可排除特定应用的内容记录
- **用户控制**: 用户完全控制数据的收集和使用

## 性能优化

### 内存管理

- **懒加载**: 按需加载大型内容
- **自动清理**: 定期清理无用对象和缓存
- **内存监控**: 响应系统内存警告

### 异步处理

- **后台处理**: 耗时操作在后台线程执行
- **UI 响应**: 保持界面流畅不阻塞
- **任务队列**: 合理安排任务优先级

## 总结

OneClip 采用简洁实用的架构设计，专注于核心功能的实现，确保应用的稳定性和性能。通过合理的组件分工和数据管理，为用户提供高效的剪贴板管理体验。