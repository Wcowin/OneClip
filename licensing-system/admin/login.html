<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>OneClip 管理后台 - 登录</title>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, Segoe UI, Roboto, Helvetica, Arial, sans-serif; background: #0f172a; color: #e2e8f0; margin: 0; }
        .container { max-width: 420px; margin: 12vh auto; background: #111827; padding: 28px; border-radius: 12px; box-shadow: 0 10px 30px rgba(0,0,0,.35); }
        h1 { margin: 0 0 16px; font-size: 22px; }
        p { margin: 0 0 24px; color: #94a3b8; }
        label { display: block; margin-bottom: 8px; color: #cbd5e1; font-weight: 600; }
        input[type=text], input[type=password] { width: 100%; padding: 12px 14px; border-radius: 10px; border: 1px solid #334155; background: #0b1220; color: #e2e8f0; margin-bottom: 16px; }
        input[type=text]:focus, input[type=password]:focus { outline: none; border-color: #2563eb; box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1); }
        button { width: 100%; margin-top: 16px; padding: 12px 14px; border: 0; border-radius: 10px; background: #2563eb; color: #fff; font-weight: 700; cursor: pointer; }
        button:disabled { background: #334155; cursor: not-allowed; }
        .msg { margin-top: 12px; font-size: 14px; min-height: 18px; }
        .err { color: #fda4af; }
        .ok { color: #4ade80; }
        .footer { text-align: center; color: #64748b; margin-top: 18px; font-size: 12px; }
        
        /* 加载动画 */
        .loading-spinner {
            display: inline-block;
            width: 16px;
            height: 16px;
            border: 2px solid #ffffff40;
            border-radius: 50%;
            border-top-color: #ffffff;
            animation: spin 1s ease-in-out infinite;
            margin-right: 8px;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        /* 响应式设计 */
        @media (max-width: 480px) {
            .container { margin: 8vh auto; padding: 20px; }
            h1 { font-size: 20px; }
            input[type=password] { padding: 14px 16px; }
            button { padding: 14px 16px; }
        }
    </style>
    <script>
        // 添加加载动画
        function showLoading(btn, text = '登录中...') {
            btn.disabled = true;
            btn.innerHTML = `<span class="loading-spinner"></span> ${text}`;
        }
        
        function hideLoading(btn, text = '登录') {
            btn.disabled = false;
            btn.innerHTML = text;
        }
        
        // 检查会话状态
        async function checkSession() {
            try {
                const res = await fetch('/api/admin/licenses', {
                    method: 'GET',
                    credentials: 'include'
                });
                if (res.ok) {
                    location.href = '/admin';
                }
            } catch (e) {
                // 忽略错误，继续显示登录页面
            }
        }
        
        async function login(ev){
            ev.preventDefault();
            const username = document.getElementById('username').value.trim();
            const password = document.getElementById('password').value.trim();
            const btn = document.getElementById('btn');
            const msg = document.getElementById('msg');
            
            if(!username){ 
                msg.textContent = '请输入用户名'; 
                msg.className = 'msg err'; 
                return; 
            }
            
            if(!password){ 
                msg.textContent = '请输入密码'; 
                msg.className = 'msg err'; 
                return; 
            }
            
            showLoading(btn, '登录中...');
            msg.textContent = ''; 
            msg.className = 'msg';
            
            try{
                const res = await fetch('/api/admin/login', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    credentials: 'include',
                    body: JSON.stringify({ username: username, password: password })
                });
                
                const data = await res.json();
                
                if(res.ok && data.success){
                    msg.textContent = '登录成功，正在进入后台...'; 
                    msg.className = 'msg ok';
                    showLoading(btn, '进入后台...');
                    setTimeout(()=> location.href='/admin', 1000);
                } else {
                    msg.textContent = data.message || '登录失败'; 
                    msg.className = 'msg err';
                    hideLoading(btn);
                }
            }catch(e){
                msg.textContent = '网络错误，请检查网络连接'; 
                msg.className = 'msg err';
                hideLoading(btn);
            }
        }
        
        // 页面加载时检查会话
        document.addEventListener('DOMContentLoaded', checkSession);
        
        // 回车键登录
        document.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                const username = document.getElementById('username');
                const password = document.getElementById('password');
                if (username.value.trim() && password.value.trim()) {
                    document.getElementById('btn').click();
                } else if (!username.value.trim()) {
                    username.focus();
                } else {
                    password.focus();
                }
            }
        });
    </script>
    </head>
<body>
    <div class="container">
        <h1>OneClip 管理后台</h1>
        <p>请输入管理员用户名和密码进入后台。</p>
        <form onsubmit="login(event)">
            <label for="username">用户名</label>
            <input id="username" type="text" placeholder="请输入用户名" required />
            <label for="password">密码</label>
            <input id="password" type="password" placeholder="••••••••" required />
            <button id="btn" type="submit">登录</button>
            <div id="msg" class="msg"></div>
        </form>
        <!-- <div class="footer">安全提示：首次部署请修改环境变量 ADMIN_USERNAME 和 ADMIN_PASSWORD</div> -->
    </div>
</body>
</html>

















